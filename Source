
-- Tự động chọn nhân vật
local function autoSelectCharacter()
    local args = {
        [1] = "012" -- Mã nhân vật (m có thể thay đổi)
    }
    game:GetService("ReplicatedStorage").Remotes.OnCharacterSelectTouchedRF:InvokeServer(unpack(args))
end

-- Tự động cầm tool
local function equipTool(toolName)
    local LocalPlayer = game:GetService("Players").LocalPlayer
    local Backpack = LocalPlayer:FindFirstChild("Backpack")
    local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

    if Backpack and Backpack:FindFirstChild(toolName) then
        local Tool = Backpack:FindFirstChild(toolName)
        Tool.Parent = Character
    end
end

-- Chỉnh hitbox
local function adjustHitbox(target, size)
    if target:FindFirstChild("HumanoidRootPart") then
        target.HumanoidRootPart.Size = size
        target.HumanoidRootPart.Transparency = 0.5
        target.HumanoidRootPart.CanCollide = false
    end
end

-- Tự động di chuyển đến gần cuối hitbox
local function moveToBottomOfHitbox(target)
    local LocalPlayer = game:GetService("Players").LocalPlayer
    local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

    if target and target:FindFirstChild("HumanoidRootPart") then
        local TargetPosition = target.HumanoidRootPart.Position
        local NewPosition = Vector3.new(TargetPosition.X, TargetPosition.Y - (400 / 2) - 2, TargetPosition.Z)

        Character:MoveTo(NewPosition)
    end
end

-- Tấn công mục tiêu đến khi chết
local function attackUntilDead(target)
    local LocalPlayer = game:GetService("Players").LocalPlayer
    local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

    local Tool = Character:FindFirstChild("Saber") -- Tool tên là Saber
    if Tool and Tool:FindFirstChild("Handle") then
        local Handle = Tool.Handle
        while target:FindFirstChild("Humanoid") and target.Humanoid.Health > 0 do
            Handle.CFrame = target.HumanoidRootPart.CFrame
            Tool:Activate()
            wait(0.2) -- Delay giữa các đòn đánh
        end
    else
        warn("Tool 'Saber' không được trang bị!")
    end
end

-- Tìm người chơi gần nhất
local function findClosestPlayer()
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer
    local Character = LocalPlayer.Character
    local ClosestPlayer = nil
    local ShortestDistance = math.huge

    if Character and Character:FindFirstChild("HumanoidRootPart") then
        local LocalPosition = Character.HumanoidRootPart.Position

        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local TargetPosition = player.Character.HumanoidRootPart.Position
                local Distance = (LocalPosition - TargetPosition).Magnitude

                if Distance < ShortestDistance then
                    ShortestDistance = Distance
                    ClosestPlayer = player
                end
            end
        end
    end

    return ClosestPlayer
end

-- Kết hợp tất cả
local function executeAutomation(targetPlayer)
    if targetPlayer and targetPlayer.Character then
        autoSelectCharacter()
        wait(1) -- Chờ nhân vật được chọn
        equipTool("Saber") -- Cầm tool tên là Saber
        adjustHitbox(targetPlayer.Character, Vector3.new(10, 400, 10)) -- Hitbox với trục Y là 400
        moveToBottomOfHitbox(targetPlayer.Character) -- Di chuyển đến gần cuối hitbox
        attackUntilDead(targetPlayer.Character) -- Tấn công đến khi mục tiêu chết
    else
        warn("Không tìm thấy người chơi gần nhất!")
    end
end

-- Chạy tự động
while wait(1) do -- Lặp lại mỗi 1 giây
    local closestPlayer = findClosestPlayer()
    if closestPlayer then
        executeAutomation(closestPlayer)
    end
end
